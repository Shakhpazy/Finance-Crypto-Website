<%- include("template/header.ejs") %>

<section id="topCryptos">
  <div class="container mt-3">
    <div class="d-flex justify-content-center mb-3">
      <h1 class="mb-1" style="color: #9593f5;">Crypto List</h1>
    </div>
    <div class="d-flex justify-content-center">

      <form id="coin-form" method="get" class="d-flex gap-1">
        <div>
          <input autocomplete="off" type="text" class="search-bar crypto form-control" placeholder="Coin Symbol (BTC)" id="search-bar-3" name="fcoin">
          <ul id="suggestions-3" class="dropdown"></ul>
        </div>
        <div>
          <button type="submit" class="calculatebutton btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
            </svg>
          </button>
        </div>
      </form>
      
    </div>
      <div class="table-responsive mt-5">
        <table class="table-dark crtable">
          <thead> 
            <tr>
              <th scope="col">#</th>
              <th scope="col">Name</th>
              <th scope="col">Price</th>
              <th scope="col">Market Cap</th>
              <th scope="col">Volume(24h)</th>
              <th scope="col">Circulating Supply</th>
            </tr>
          </thead>
          <% if (data.length > 0) { %>
          <tbody>
            <% for( let i = 0; i < data.length; i++ ) { %>
              <tr>
                <td><%= ((currentPage - 1) * data.length + i + 1) %></td>
                <td><a href="/coin/<%= data[i].name %>" style="text-decoration: none; color: white;"><img src="<%= data[i].logo_url %>" class = "cryptologos" alt="Logo" style="width: 32px; height: auto; margin-right: 5px;" /><span><%= data[i].name %> <span style="font-weight: 400; color: #595f70;";"><%= data[i].symbol %></span></span></a></td>
                <td>$<%= Number(Number(data[i].price).toFixed(2)).toLocaleString() %></td>
                <td>$<%= Number(Number(data[i].market_cap).toFixed(2)).toLocaleString() %></td>
                <td>$<%= Number(Number(data[i].volume_24h).toFixed(2)).toLocaleString() %></td>
                <td><%=  data[i].circulating_supply %></td>
              </tr>
            <% } %>
          </tbody>
          <% } else { %>
            <tr>
              <td colspan="6" class="text-center">No data found</td>
            </tr>
          <% } %>
        </table>
      </div>
      <div class="mt-3">
        <nav aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center">
              <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                  <a class="page-link" href="?page=<%= currentPage - 1 %>" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                  </a>
              </li>

                <% 
                    let startPage = Math.max(1, currentPage - 2); 
                    let endPage = Math.min(pageCount, currentPage + 2); 

                    for (let i = startPage; i <= endPage; i++) { 
                %>
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                    </li>
                <% } %>

              <li class="page-item <%= currentPage === pageCount ? 'disabled' : '' %>">
                  <a class="page-link" href="?page=<%= currentPage + 1 %>" aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                  </a>
              </li>
          </ul>
        </nav>
      </div>
  </div>
</section>
<script src="/search.js"></script>

<%- include('template/footer.ejs') %>